{%- if module == 'root' %}
{%-   for provider, config in args.providers.items() %}
{%-     if config != {} %}
# Provider {{ provider }} config
provider "{{ provider|lower }}" {
{%-       if provider|lower == 'azurerm' %}
    environment     = {{ config['environment']|default("public") }}
    features        = {{ config['features'] }}
    subscription_id = {{ config['subscription_id']|default("") }}
    tenant_id       = {{ config['tenant_id']|default("") }}
{%-       elif provider|lower == 'digitalocean' %}
    api_endpoint = "{{ config['config']|default('https://api.digitalocean.com') }}"
    token        = {{ config['token']|default("") }}
{%-       elif provider|lower == 'vsphere' %}
    allow_unverified_ssl = {{ config['allow_unverified_ssl'] }}
    password = {{ config['password'] }}
    user = {{ config['user'] }}
    vsphere_server = {{ config['vsphere_server'] }}
{%-       endif %}
}
{%-     endif -%}
{%-   endfor %}
{%-   for environment in args.environments %}
# Module {{ environment }} config
module "{{ environment }}" {
    source = "./environments/{{ environment }}"
}
{%-   endfor %}
# Setting required Terraform version or greater
terraform {
  required_version = ">= 0.12"
}
{%- elif module in args.environments %}
{%-   for module in args.modules %}
{%-      if module != 'root' %}
# Module {{ module }} config
module "{{ module }}" {
    source = "../../modules/{{ module }}"
}
{%-      endif %}
{%-    endfor -%}
{% endif %}