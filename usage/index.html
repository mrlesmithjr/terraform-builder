<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Terraform Builder Usage - Terraform Builder</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Terraform Builder Usage";
    var mkdocs_page_input_path = "usage.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Terraform Builder</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Terraform Builder</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../about/">About Terraform Builder</a>
                    </li>
                </ul>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Terraform Builder Usage</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#requirements">Requirements</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#clone-project">Clone Project</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#python-packages">Python Packages</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#terraform-version-manager">Terraform Version Manager</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#graphviz">Graphviz</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-terraform-builder">Using Terraform Builder</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#configurations">Configurations</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#backends">Backends</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#local">Local</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#consul">Consul</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#providers">Providers</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#resources">Resources</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#example-configuration">Example Configuration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#help">Help</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#executing">Executing</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#demos">Demos</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#azure">Azure</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#create-project-directory">Create project directory</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#install-azure-cli">Install Azure CLI</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#clone-terraform-builder">Clone Terraform Builder</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#azure-service-principal">Azure Service Principal</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#configs-and-secrets">Configs and Secrets</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#build-project">Build Project</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Example builds</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Example</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../example_builds/example/">Terraform Project - example</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../example_builds/example/LICENSE/">LICENSE</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Environments</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="#">Development</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../example_builds/example/environments/development/">Terraform Project - example - Module development</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../example_builds/example/environments/development/LICENSE/">LICENSE</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="#">Production</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../example_builds/example/environments/production/">Terraform Project - example - Module production</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../example_builds/example/environments/production/LICENSE/">LICENSE</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="#">Staging</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../example_builds/example/environments/staging/">Terraform Project - example - Module staging</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../example_builds/example/environments/staging/LICENSE/">LICENSE</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Modules</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="#">Network</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../example_builds/example/modules/network/">Terraform Project - example - Module network</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../example_builds/example/modules/network/LICENSE/">LICENSE</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="#">Services</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../example_builds/example/modules/services/">Terraform Project - example - Module services</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../example_builds/example/modules/services/LICENSE/">LICENSE</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Root</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../example_builds/example/root/">Terraform Project - example - Module root</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../example_builds/example/root/LICENSE/">LICENSE</a>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Terraform Builder</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Terraform Builder Usage</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="terraform-builder-usage">Terraform Builder Usage</h1>
<h2 id="requirements">Requirements</h2>
<h3 id="clone-project">Clone Project</h3>
<p>To obtain the project simply clone it down:</p>
<pre><code class="bash">git clone https://github.com/mrlesmithjr/terraform-builder
</code></pre>

<h3 id="python-packages">Python Packages</h3>
<p>Install required Python packages included in the project you cloned from above.</p>
<pre><code class="bash">pip3 install -r requirements.txt
</code></pre>

<h3 id="terraform-version-manager">Terraform Version Manager</h3>
<p>Terraform version manager is a tool that I use personally. It assists in easily
managing different Terraform versions for you to use. Rather than installing a
version, and then having to do some random things to switch between versions.
Definitely check it out <a href="https://github.com/tfutils/tfenv">here</a>.</p>
<h3 id="graphviz">Graphviz</h3>
<p>It is recommended that you install <a href="https://graphviz.gitlab.io/download/">Graphviz</a> to get a visible graph in your project README.</p>
<h2 id="using-terraform-builder">Using Terraform Builder</h2>
<p>Is using Terraform Builder easy? Of course it is. But first we need to explore
some of the concepts.</p>
<h2 id="configurations">Configurations</h2>
<p>Configurations are defined in YAML, and must follow a specific format. By doing
this, we can ensure that we have consistency in our Terraform configurations. We
use <code>configs.yml</code> but the filename can be anything you wish. However, the
content must be consistent.</p>
<h3 id="backends">Backends</h3>
<p>We can configure different Terraform backends to use for our Terraform state.
Initially this functionality is limited to the default <code>local</code> and <code>Consul</code>.
<code>Consul</code> support is limited and under development now. But you can use it for
testing purposes until fully implemented.</p>
<h4 id="local">Local</h4>
<p>The default <code>local</code> is defined and should always be defined. But, if
you don't. It will still default back to local without the added configs.</p>
<pre><code class="yaml"># Define backends
backends:
  local:
    path: terraform.tfstate
  remote:
    {}
    # consul:
    #   address: http://127.0.0.1:8500
    #   scheme: http
    #   path: example/terraform
</code></pre>

<h4 id="consul">Consul</h4>
<p>To enable <code>Consul</code> as a backend, simply add the relevant info as below:</p>
<blockquote>
<p>NOTE: Leave <code>local</code> configured as a fallback. If <code>Consul</code> is configured, it
will default to it rather than <code>local</code>.</p>
</blockquote>
<pre><code class="yaml"># Define backends
backends:
  local:
    path: terraform.tfstate
  remote:
    consul:
      address: http://127.0.0.1:8500
      scheme: http
      path: example/terraform
</code></pre>

<h3 id="providers">Providers</h3>
<p>We can configure specific providers in our <code>configs.yml</code>.</p>
<h4 id="resources">Resources</h4>
<p>Resources are where we can defined things such as VMs, resource groups, etc. For
example, VMs are defined in an agnostic way in which you can cut/paste VM resources
between providers. When doing this, the backend configurations are handled for
us to translate to the specific provider.</p>
<p>For some resources, we can define <code>create: true</code> or <code>create: false</code>. By doing
this, we define the resource to be created or consume an existing resource. An
example of this is for the <code>AzureRM</code> provider. In which we would like to define
resource groups in a way similar to:</p>
<pre><code class="yaml">providers:
  AzureRM:
    resources:
      resource_groups:
        default:
          create: false
          module: root
        example:
          create: true
          module: services
</code></pre>

<p>If we were to use the above configuration, we would end up with configurations
that look similar to:</p>
<pre><code class="json"># Data AzureRM resource group
data &quot;azurerm_resource_group&quot; &quot;default&quot; {
        name     = &quot;default&quot;
}
# Resource AzureRM resource group
resource &quot;azurerm_resource_group&quot; &quot;example&quot; {
        name     = &quot;example&quot;
        location = var.azurerm_location
}
</code></pre>

<h3 id="example-configuration">Example Configuration</h3>
<p>Below is an example of our <code>configs.yml</code>:</p>
<blockquote>
<p>NOTE: You can always find an updated example <a href="https://raw.githubusercontent.com/mrlesmithjr/terraform-builder/master/examples/configs.yml">here</a></p>
</blockquote>
<pre><code class="yaml">---
# This is an example config layout

# Defines project name which becomes parent root directory
project_name: example

# Define backends
backends:
  local: {}
  remote: {}

# Defines environments
environments:
  development: {}
  production: {}
  staging: {}

# Define global variables
global_variables: {}

# Define modules - Structure will be project_name/modules/{module}
# root needs to always exist
modules:
  root: {}
  network: {}
  services: {}

# Define providers and variables
providers:
  AzureRM:
    resources:
      networks:
        example:
          create: true
          module: services
          network: 10.0.0.0/16
          resource_group: example
          subnets:
            - 10.0.1.0/24
            - 10.0.2.0/24
      resource_groups:
        default:
          create: false
          module: root
        example:
          create: true
          module: services
      vms:
        test-az-root:
          count: 2
          image: ubuntu-18-04-x64
          memory: 1024
          module: services
          network: example
          subnet: 10.0.2.0/24
          num_cpus: 1
          tags:
            - test-azurerm
            - test-azurerm-root
    variables:
      azurerm_domain:
        type: string
        description: Default AzureRM domain for resources
        default: &quot;&quot;
      azurerm_environment:
        type: string
        description: AzureRM Environment
        default: public
      azurerm_features:
        description: Customize the behaviour of certain Azure Provider resources.
        default: {}
      azurerm_image_reference:
        description: Default OS image reference lookups
        default:
          {
            &quot;ubuntu-16-04-x64&quot;:
              {
                &quot;publisher&quot;: &quot;Canonical&quot;,
                &quot;offer&quot;: &quot;UbuntuServer&quot;,
                &quot;sku&quot;: &quot;16.04-LTS&quot;,
                &quot;version&quot;: &quot;latest&quot;,
              },
            &quot;ubuntu-18-04-x64&quot;:
              {
                &quot;publisher&quot;: &quot;Canonical&quot;,
                &quot;offer&quot;: &quot;UbuntuServer&quot;,
                &quot;sku&quot;: &quot;18.04-LTS&quot;,
                &quot;version&quot;: &quot;latest&quot;,
              },
          }
      azurerm_location:
        type: string
        description: Default AzureRM location/region
        default: East US
      azurerm_subscription_id:
        type: string
        description: AzureRM Subscription ID
        default: &quot;&quot;
      azurerm_tenant_id:
        type: string
        description: AzureRM Tenant ID
        default: &quot;&quot;
  DigitalOcean:
    resources:
      vms:
        test-do-root:
          count: 1
          image: ubuntu-18-04-x64
          memory: 1024
          module: root
          num_cpus: 1
          tags:
            - test-digitalocean
            - test-digitalocean-root
        test-do-network:
          count: 1
          image: ubuntu-18-04-x64
          memory: 1024
          module: network
          num_cpus: 1
          tags:
            - test-digitalocean
            - test-digitalocean-network
    variables:
      do_api_endpoint:
        type: string
        description: This can be used to override the base URL for DigitalOcean API requests
        default: https://api.digitalocean.com
      do_domain:
        type: string
        description: Default DigitalOcean domain for resources
        default: &quot;&quot;
      do_region:
        type: string
        description: DigitalOcean region
        default: nyc1
      do_ssh_keys:
        type: string
        description: DigitalOcean SSH keys to deploy to new droplets
        default: []
      do_token:
        type: string
        description: This is the DO API token
        default: &quot;&quot;
  vSphere:
    resources:
      vms:
        test-vs-root:
          count: 1
          memory: 2048
          module: root
          num_cpus: 1
          tags:
            - test-vsphere
            - test-vsphere-root
        test-vs-services:
          count: 1
          memory: 1024
          module: services
          num_cpus: 2
          tags:
            - test-vsphere
            - test-vsphere-services
    variables:
      vsphere_allow_unverified_ssl:
        type: bool
        description: Boolean that can be set to true to disable SSL certificate verification
        default: &quot;false&quot;
      vsphere_compute_cluster:
        type: string
        description: Compute cluster to use by default
        default: &quot;&quot;
      vsphere_datacenter:
        type: string
        description: Datacenter to use by default
        default: &quot;&quot;
      vsphere_network:
        type: string
        description: Network to use by default
        default: &quot;&quot;
      vsphere_password:
        type: string
        description: Password for vSphere API operations
        default: &quot;&quot;
      vsphere_resource_pool:
        type: string
        description: The resource pool to put virtual machine's in
        default: &quot;&quot;
      vsphere_server:
        type: string
        description: vCenter server name for vSphere API operations
        default: &quot;&quot;
      vsphere_username:
        type: string
        description: Username for vSphere API operations
        default: &quot;&quot;
</code></pre>

<p>To properly secure secrets such as API tokens, usernames, passwords, etc.
Ensure to define them in <code>secrets.yml</code> and not in <code>configs.yml</code>. Anything placed in <code>secrets.yml</code> will be created in the root module folder as <code>terraform.tfvars.json</code>.</p>
<p>Example of <code>secrets.yml</code>:</p>
<pre><code class="yaml">---
# Define secrets - Use with caution
secrets:
  {}
  # azurerm_subscription_id: SuperSecretSubscriptionID
  # azurerm_tenant_id: SuperSecretTenantID
  # do_token: SuperSecretAPItoken
  # vsphere_password: SuperSecretPass
  # vsphere_username: SuperSecretUser
</code></pre>

<h3 id="help">Help</h3>
<p>You can get Terraform Builder help:</p>
<pre><code class="bash">python -m terraform_builder -h
...
usage: __main__.py [-h] [--config CONFIG] [--outputdir OUTPUTDIR]
                   [--secrets SECRETS] [--version]

optional arguments:
  -h, --help            show this help message and exit
  --config CONFIG       Configuration (YAML) to load
  --outputdir OUTPUTDIR
                        Define path to save configs.
  --secrets SECRETS     Path to secrets
  --version             show program's version number and exit
</code></pre>

<h3 id="executing">Executing</h3>
<p>Executing Terraform Builder is extremely easy as well. Of course!</p>
<p>You can play with the configs.yml` included in <a href="https://github.com/mrlesmithjr/terraform-builder/tree/master/examples">examples</a> to get familiar with the
concepts, etc.</p>
<pre><code class="bash">python -m terraform_builder --config examples/configs.yml --outputdir examples/example_builds
...
Initializing modules...

Initializing the backend...

Initializing provider plugins...

The following providers do not have any version constraints in configuration,
so the latest version was installed.

To prevent automatic upgrades to new major versions that may contain breaking
changes, it is recommended to add version = &quot;...&quot; constraints to the
corresponding provider blocks in configuration, with the constraint strings
suggested below.

* provider.azurerm: version = &quot;~&gt; 2.2&quot;
* provider.digitalocean: version = &quot;~&gt; 1.15&quot;
* provider.vsphere: version = &quot;~&gt; 1.16&quot;

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.

Success! The configuration is valid.
</code></pre>

<p>As you can see from above, there is very minimal output. However, after the
configurations have been generated, <code>terraform init</code> and <code>terraform validate</code>
are invoked in the <code>--outputdir</code>. By doing this we can ensure that our
configurations are good.</p>
<p>You will also find a <code>logs/terraform_builder.log</code>, which has a good amount of
info collected throughout the Terraform Builder process.</p>
<p>Example of <code>logs/terraform_builder.log</code>:</p>
<pre><code class="bash">2020-03-20 21:23:04,460 - terraform_builder.config - INFO - Loading config: examples/configs.yml
2020-03-20 21:23:04,479 - terraform_builder.config - INFO - Data found: {'project_name': 'example', 'backends': {'local': {}, 'remote': {}}, 'environments': {'development': {}, 'production': {}, 'staging': {}}, 'global_variables': {}, 'modules': {'root': {}, 'network': {}, 'services': {}}, 'providers': {'AzureRM': {'variables': {'azurerm_environment': {'type': 'string', 'description': 'AzureRM Environment', 'default': 'public'}, 'azurerm_features': {'description': 'Customize the behaviour of certain Azure Provider resources.', 'default': {}}, 'azurerm_subscription_id': {'type': 'string', 'description': 'AzureRM Subscription ID', 'default': ''}, 'azurerm_tenant_id': {'type': 'string', 'description': 'AzureRM Tenant ID', 'default': ''}}}, 'DigitalOcean': {'variables': {'do_api_endpoint': {'type': 'string', 'description': 'This can be used to override the base URL for DigitalOcean API requests', 'default': 'https://api.digitalocean.com'}, 'do_image': {'type': 'string', 'description': 'Default DigitalOcean droplet image', 'default': 'ubuntu-18-04-x64'}, 'do_region': {'type': 'string', 'description': 'DigitalOcean region', 'default': 'nyc1'}, 'do_ssh_keys': {'type': 'string', 'description': 'DigitalOcean SSH keys to deploy to new droplets', 'default': []}, 'do_token': {'type': 'string', 'description': 'This is the DO API token', 'default': ''}}}, 'vSphere': {'variables': {'vsphere_allow_unverified_ssl': {'type': 'bool', 'description': 'Boolean that can be set to true to disable SSL certificate verification', 'default': 'false'}, 'vsphere_compute_cluster': {'type': 'string', 'description': 'Compute cluster to use by default', 'default': ''}, 'vsphere_datacenter': {'type': 'string', 'description': 'Datacenter to use by default', 'default': ''}, 'vsphere_network': {'type': 'string', 'description': 'Network to use by default', 'default': ''}, 'vsphere_password': {'type': 'string', 'description': 'Password for vSphere API operations', 'default': ''}, 'vsphere_resource_pool': {'type': 'string', 'description': &quot;The resource pool to put virtual machine's in&quot;, 'default': ''}, 'vsphere_server': {'type': 'string', 'description': 'vCenter server name for vSphere API operations', 'default': ''}, 'vsphere_username': {'type': 'string', 'description': 'Username for vSphere API operations', 'default': ''}}}}, 'resources': {'projects': {'TerraformCloud': {'description': 'Terraform Cloud Project', 'environment': 'development', 'module': 'root', 'provider': 'DigitalOcean', 'purpose': 'Terraform Cloud Project', 'resources': [], 'tags': ['test']}}, 'vms': {'test-do-root': {'count': 1, 'memory': 1024, 'module': 'root', 'num_cpus': 1, 'provider': 'DigitalOcean', 'tags': ['test-digitalocean', 'test-digitalocean-root']}, 'test-do-network': {'count': 1, 'memory': 1024, 'module': 'network', 'num_cpus': 1, 'provider': 'DigitalOcean', 'tags': ['test-digitalocean', 'test-vsphere-network']}, 'test-vs-root': {'count': 1, 'memory': 2048, 'module': 'root', 'num_cpus': 1, 'provider': 'vSphere', 'tags': ['test-vsphere', 'test-vsphere-root']}, 'test-vs-services': {'count': 1, 'memory': 1024, 'module': 'services', 'num_cpus': 2, 'provider': 'vSphere', 'tags': ['test-vsphere', 'test-vsphere-services']}}}}
2020-03-20 21:23:04,479 - terraform_builder.config - INFO - Loading secrets: /Users/larrysmithjr/Git_Projects/Personal/GitHub/mrlesmithjr/terraform-builder/examples/secrets.yml
2020-03-20 21:23:04,480 - terraform_builder.build - INFO - project_root: examples/example_builds/example
2020-03-20 21:23:04,480 - terraform_builder.build - INFO - Rendering template for module: root using: main.tf.j2
2020-03-20 21:23:04,495 - terraform_builder.build - INFO - Creating: examples/example_builds/example/main.tf
2020-03-20 21:23:04,495 - terraform_builder.build - INFO - Rendering template for module: root using: resources.tf.j2
2020-03-20 21:23:04,520 - terraform_builder.build - INFO - Creating: examples/example_builds/example/resources.tf
2020-03-20 21:23:04,520 - terraform_builder.build - INFO - Rendering template for module: root using: variables.tf.j2
2020-03-20 21:23:04,531 - terraform_builder.build - INFO - Creating: examples/example_builds/example/variables.tf
2020-03-20 21:23:04,532 - terraform_builder.build - INFO - Rendering template for module: development using: main.tf.j2
2020-03-20 21:23:04,543 - terraform_builder.build - INFO - Creating: examples/example_builds/example/environments/development/main.tf
2020-03-20 21:23:04,543 - terraform_builder.build - INFO - Rendering template for module: development using: resources.tf.j2
2020-03-20 21:23:04,569 - terraform_builder.build - INFO - Creating: examples/example_builds/example/environments/development/resources.tf
2020-03-20 21:23:04,569 - terraform_builder.build - INFO - Rendering template for module: development using: variables.tf.j2
2020-03-20 21:23:04,580 - terraform_builder.build - INFO - Creating: examples/example_builds/example/environments/development/variables.tf
2020-03-20 21:23:04,581 - terraform_builder.build - INFO - Rendering template for module: production using: main.tf.j2
2020-03-20 21:23:04,593 - terraform_builder.build - INFO - Creating: examples/example_builds/example/environments/production/main.tf
2020-03-20 21:23:04,593 - terraform_builder.build - INFO - Rendering template for module: production using: resources.tf.j2
2020-03-20 21:23:04,620 - terraform_builder.build - INFO - Creating: examples/example_builds/example/environments/production/resources.tf
2020-03-20 21:23:04,620 - terraform_builder.build - INFO - Rendering template for module: production using: variables.tf.j2
2020-03-20 21:23:04,631 - terraform_builder.build - INFO - Creating: examples/example_builds/example/environments/production/variables.tf
2020-03-20 21:23:04,632 - terraform_builder.build - INFO - Rendering template for module: staging using: main.tf.j2
2020-03-20 21:23:04,643 - terraform_builder.build - INFO - Creating: examples/example_builds/example/environments/staging/main.tf
2020-03-20 21:23:04,643 - terraform_builder.build - INFO - Rendering template for module: staging using: resources.tf.j2
2020-03-20 21:23:04,668 - terraform_builder.build - INFO - Creating: examples/example_builds/example/environments/staging/resources.tf
2020-03-20 21:23:04,668 - terraform_builder.build - INFO - Rendering template for module: staging using: variables.tf.j2
2020-03-20 21:23:04,681 - terraform_builder.build - INFO - Creating: examples/example_builds/example/environments/staging/variables.tf
2020-03-20 21:23:04,682 - terraform_builder.build - INFO - Rendering template for module: network using: main.tf.j2
2020-03-20 21:23:04,694 - terraform_builder.build - INFO - Creating: examples/example_builds/example/modules/network/main.tf
2020-03-20 21:23:04,694 - terraform_builder.build - INFO - Rendering template for module: network using: resources.tf.j2
2020-03-20 21:23:04,720 - terraform_builder.build - INFO - Creating: examples/example_builds/example/modules/network/resources.tf
2020-03-20 21:23:04,720 - terraform_builder.build - INFO - Rendering template for module: network using: variables.tf.j2
2020-03-20 21:23:04,732 - terraform_builder.build - INFO - Creating: examples/example_builds/example/modules/network/variables.tf
2020-03-20 21:23:04,733 - terraform_builder.build - INFO - Rendering template for module: services using: main.tf.j2
2020-03-20 21:23:04,747 - terraform_builder.build - INFO - Creating: examples/example_builds/example/modules/services/main.tf
2020-03-20 21:23:04,748 - terraform_builder.build - INFO - Rendering template for module: services using: resources.tf.j2
2020-03-20 21:23:04,779 - terraform_builder.build - INFO - Creating: examples/example_builds/example/modules/services/resources.tf
2020-03-20 21:23:04,779 - terraform_builder.build - INFO - Rendering template for module: services using: variables.tf.j2
2020-03-20 21:23:04,797 - terraform_builder.build - INFO - Creating: examples/example_builds/example/modules/services/variables.tf
2020-03-20 21:23:04,797 - terraform_builder.specs.important.files - INFO - configs: {'project_name': 'example', 'backends': {'local': {}, 'remote': {}}, 'environments': {'development': {}, 'production': {}, 'staging': {}}, 'global_variables': {}, 'modules': {'root': {}, 'network': {}, 'services': {}}, 'providers': {'AzureRM': {'variables': {'azurerm_environment': {'type': 'string', 'description': 'AzureRM Environment', 'default': 'public'}, 'azurerm_features': {'description': 'Customize the behaviour of certain Azure Provider resources.', 'default': {}}, 'azurerm_subscription_id': {'type': 'string', 'description': 'AzureRM Subscription ID', 'default': ''}, 'azurerm_tenant_id': {'type': 'string', 'description': 'AzureRM Tenant ID', 'default': ''}}}, 'DigitalOcean': {'variables': {'do_api_endpoint': {'type': 'string', 'description': 'This can be used to override the base URL for DigitalOcean API requests', 'default': 'https://api.digitalocean.com'}, 'do_image': {'type': 'string', 'description': 'Default DigitalOcean droplet image', 'default': 'ubuntu-18-04-x64'}, 'do_region': {'type': 'string', 'description': 'DigitalOcean region', 'default': 'nyc1'}, 'do_ssh_keys': {'type': 'string', 'description': 'DigitalOcean SSH keys to deploy to new droplets', 'default': []}, 'do_token': {'type': 'string', 'description': 'This is the DO API token', 'default': ''}}}, 'vSphere': {'variables': {'vsphere_allow_unverified_ssl': {'type': 'bool', 'description': 'Boolean that can be set to true to disable SSL certificate verification', 'default': 'false'}, 'vsphere_compute_cluster': {'type': 'string', 'description': 'Compute cluster to use by default', 'default': ''}, 'vsphere_datacenter': {'type': 'string', 'description': 'Datacenter to use by default', 'default': ''}, 'vsphere_network': {'type': 'string', 'description': 'Network to use by default', 'default': ''}, 'vsphere_password': {'type': 'string', 'description': 'Password for vSphere API operations', 'default': ''}, 'vsphere_resource_pool': {'type': 'string', 'description': &quot;The resource pool to put virtual machine's in&quot;, 'default': ''}, 'vsphere_server': {'type': 'string', 'description': 'vCenter server name for vSphere API operations', 'default': ''}, 'vsphere_username': {'type': 'string', 'description': 'Username for vSphere API operations', 'default': ''}}}}, 'resources': {'projects': {'TerraformCloud': {'description': 'Terraform Cloud Project', 'environment': 'development', 'module': 'root', 'provider': 'DigitalOcean', 'purpose': 'Terraform Cloud Project', 'resources': [], 'tags': ['test']}}, 'vms': {'test-do-root': {'count': 1, 'memory': 1024, 'module': 'root', 'num_cpus': 1, 'provider': 'DigitalOcean', 'tags': ['test-digitalocean', 'test-digitalocean-root']}, 'test-do-network': {'count': 1, 'memory': 1024, 'module': 'network', 'num_cpus': 1, 'provider': 'DigitalOcean', 'tags': ['test-digitalocean', 'test-vsphere-network']}, 'test-vs-root': {'count': 1, 'memory': 2048, 'module': 'root', 'num_cpus': 1, 'provider': 'vSphere', 'tags': ['test-vsphere', 'test-vsphere-root']}, 'test-vs-services': {'count': 1, 'memory': 1024, 'module': 'services', 'num_cpus': 2, 'provider': 'vSphere', 'tags': ['test-vsphere', 'test-vsphere-services']}}}}
2020-03-20 21:23:04,798 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/modules/network/LICENSE.md
2020-03-20 21:23:04,798 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/modules/services/LICENSE.md
2020-03-20 21:23:04,799 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/environments/development/LICENSE.md
2020-03-20 21:23:04,799 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/environments/production/LICENSE.md
2020-03-20 21:23:04,799 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/environments/staging/LICENSE.md
2020-03-20 21:23:04,818 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/modules/network/README.md
2020-03-20 21:23:04,818 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/modules/services/README.md
2020-03-20 21:23:04,819 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/environments/development/README.md
2020-03-20 21:23:04,820 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/environments/production/README.md
2020-03-20 21:23:04,821 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/environments/staging/README.md
2020-03-20 21:23:04,821 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/LICENSE.md
2020-03-20 21:23:04,839 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/README.md
2020-03-20 21:23:04,840 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/.gitignore
2020-03-20 21:23:04,841 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/requirements.txt
2020-03-20 21:23:04,843 - terraform_builder.specs.important.files - INFO - Creating important file: examples/example_builds/example/requirements-dev.txt
2020-03-20 21:23:04,843 - terraform_builder.build - INFO - terraform_path: /usr/local/bin/terraform
2020-03-20 21:23:04,843 - terraform_builder.build - INFO - Initializing config in: examples/example_builds/example
2020-03-20 21:23:05,674 - terraform_builder.build - INFO - terraform init: [0m[1mInitializing modules...[0m

[0m[1mInitializing the backend...[0m

[0m[1mInitializing provider plugins...[0m

The following providers do not have any version constraints in configuration,
so the latest version was installed.

To prevent automatic upgrades to new major versions that may contain breaking
changes, it is recommended to add version = &quot;...&quot; constraints to the
corresponding provider blocks in configuration, with the constraint strings
suggested below.

* provider.azurerm: version = &quot;~&gt; 2.2&quot;
* provider.digitalocean: version = &quot;~&gt; 1.15&quot;
* provider.vsphere: version = &quot;~&gt; 1.16&quot;

[0m[1m[32mTerraform has been successfully initialized![0m[32m[0m
[0m[32m
You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.[0m

2020-03-20 21:23:05,674 - terraform_builder.build - INFO - Validating config in: examples/example_builds/example
2020-03-20 21:23:07,153 - terraform_builder.build - INFO - terraform validate: [32m[1mSuccess![0m The configuration is valid.
[0m

</code></pre>

<h2 id="demos">Demos</h2>
<h3 id="azure">Azure</h3>
<p>For this demo I'll be walking through building out some resources in Azure. I
am using macOS therefore I need to install the Azure CLI tool. I'll also be
creating a new project in my <code>$HOME/Playground/Terraform_Project</code> directory.</p>
<h4 id="create-project-directory">Create project directory</h4>
<pre><code class="bash">mkdir -p $HOME/Playground/Terraform_Project
</code></pre>

<h4 id="install-azure-cli">Install Azure CLI</h4>
<pre><code class="bash">brew install azure-cli
</code></pre>

<h4 id="clone-terraform-builder">Clone Terraform Builder</h4>
<pre><code class="bash">cd $HOME/Playground/
git clone https://github.com/mrlesmithjr/terraform-builder.git
</code></pre>

<h4 id="azure-service-principal">Azure Service Principal</h4>
<p>Next I'll need to create a Service Principal to <a href="https://www.terraform.io/docs/providers/azurerm/index.html#authenticating-to-azure">authenticate</a> with.</p>
<p>Let's go ahead and login using the Azure CLI tool.</p>
<pre><code class="bash">az login
</code></pre>

<p>You should have been redirected with your browser to authenticate at this point.
And if you go back to your terminal you should see something similar to:</p>
<pre><code class="bash">[
  {
    &quot;cloudName&quot;: &quot;AzureCloud&quot;,
    &quot;id&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,
    &quot;isDefault&quot;: true,
    &quot;name&quot;: &quot;PAYG Subscription&quot;,
    &quot;state&quot;: &quot;Enabled&quot;,
    &quot;tenantId&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,
    &quot;user&quot;: {
      &quot;name&quot;: &quot;user@example.com&quot;,
      &quot;type&quot;: &quot;user&quot;
    }
  }
]
</code></pre>

<p>We are now ready to create the Service Principal.</p>
<p>Using the <code>id</code> to replace <code>SUBSCRIPTION_ID</code> below.</p>
<pre><code class="bash">az ad sp create-for-rbac --role=&quot;Contributor&quot; --scopes=&quot;/subscriptions/SUBSCRIPTION_ID&quot;
</code></pre>

<p>You should get back something similar to below:</p>
<pre><code class="bash">{
  &quot;appId&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,
  &quot;displayName&quot;: &quot;azure-cli-2017-06-05-10-41-15&quot;,
  &quot;name&quot;: &quot;http://azure-cli-2017-06-05-10-41-15&quot;,
  &quot;password&quot;: &quot;0000-0000-0000-0000-000000000000&quot;,
  &quot;tenant&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;
}
</code></pre>

<h4 id="configs-and-secrets">Configs and Secrets</h4>
<p>Now you will need to configure your <code>secrets.yml</code> file to look like below using
the <code>SUBSCRIPTION_ID</code> that you received after doing <code>az login</code>. The remaining
three fields will be from the information you received after creating the Service
Principal.</p>
<p><code>$HOME/Playground/Terraform_Project/secrets.yml</code>:</p>
<pre><code class="yaml">---
# Define secrets - Use with caution
secrets:
  azurerm_client_id: appID
  azurerm_client_secret: password
  azurerm_subscription_id: SUBSCRIPTION_ID
  azurerm_tenant_id: tenant
</code></pre>

<p>Now we need to configure our <code>configs.yml</code> file to look similar to below:</p>
<p><code>$HOME/Playground/Terraform_Project/configs.yml</code>:</p>
<pre><code class="yaml">---
# This is an example config layout

# Defines project name which becomes parent root directory
project_name: Terraform-Playground

# Define backends
backends:
  local: {}
  remote: {}

# Defines environments
environments:
  development: {}
  production: {}
  staging: {}

# Define global variables
global_variables: {}

# Define modules - Structure will be project_name/modules/{module}
# root needs to always exist
modules:
  root: {}

# Define providers and variables
providers:
  AzureRM:
    resources:
      resource_groups:
        example-rg-root:
          create: true
          module: root
          virtual_networks:
            {}
            # example-net:
            #   address_space:
            #     - 10.0.0.0/16
            #   create: true
            #   subnets:
            #     - 10.0.1.0/24
            #     - 10.0.2.0/24
          vms:
            {}
            # example-vm-root:
            #   count: 1
            #   image: ubuntu-18-04-x64
            #   memory: 1024
            #   network: example-net
            #   subnet: 10.0.2.0/24
            #   num_cpus: 1
            #   tags: { &quot;environment&quot;: &quot;${var.environment}&quot; }
    variables:
      azurerm_client_id:
        type: string
        description: Default AzureRM client id
        default: &quot;&quot;
      azurerm_client_secret:
        type: string
        description: Default AzureRM client secret
        default: &quot;&quot;
      azurerm_domain:
        type: string
        description: Default AzureRM domain for resources
        default: &quot;&quot;
      azurerm_environment:
        type: string
        description: AzureRM Environment
        default: public
      azurerm_features:
        description: Customize the behaviour of certain Azure Provider resources.
        default: {}
      azurerm_image_reference:
        description: Default OS image reference lookups
        default:
          {
            &quot;ubuntu-16-04-x64&quot;:
              {
                &quot;publisher&quot;: &quot;Canonical&quot;,
                &quot;offer&quot;: &quot;UbuntuServer&quot;,
                &quot;sku&quot;: &quot;16.04-LTS&quot;,
                &quot;version&quot;: &quot;latest&quot;,
              },
            &quot;ubuntu-18-04-x64&quot;:
              {
                &quot;publisher&quot;: &quot;Canonical&quot;,
                &quot;offer&quot;: &quot;UbuntuServer&quot;,
                &quot;sku&quot;: &quot;18.04-LTS&quot;,
                &quot;version&quot;: &quot;latest&quot;,
              },
          }
      azurerm_location:
        type: string
        description: Default AzureRM location/region
        default: East US
      azurerm_subscription_id:
        type: string
        description: AzureRM Subscription ID
        default: &quot;&quot;
      azurerm_tenant_id:
        type: string
        description: AzureRM Tenant ID
        default: &quot;&quot;
</code></pre>

<h4 id="build-project">Build Project</h4>
<p>After we've configured our <code>secrets.yml</code> and <code>configs.yml</code> files in our
<code>$HOME/Playground/Terraform_Project</code> directory. We are now ready to build our
Terraform project.</p>
<pre><code class="bash">cd $HOME/Playground/terraform-builder
</code></pre>

<p>We now need to install a few Python packages which are required and we will do
so in a Python virtual environment.</p>
<p>First, create Python virtual environment:</p>
<pre><code class="bash">python3 -m venv venv
</code></pre>

<p>Next activate the Python virtual environment:</p>
<pre><code class="bash">source venv/bin/activate
</code></pre>

<p>Now let's install the required Python packages:</p>
<pre><code class="bash">pip3 install -r requirements.txt
</code></pre>

<p>Once this has completed we are ready to build our project.</p>
<pre><code class="bash">python -m terraform_builder --config $HOME/Playground/Terraform_Project/configs.yml --secrets $HOME/Playground/Terraform_Project/secrets.yml --outputdir $HOME/Playground/Terraform_Project
...
Initializing modules...

Initializing the backend...

Initializing provider plugins...

The following providers do not have any version constraints in configuration,
so the latest version was installed.

To prevent automatic upgrades to new major versions that may contain breaking
changes, it is recommended to add version = &quot;...&quot; constraints to the
corresponding provider blocks in configuration, with the constraint strings
suggested below.

* provider.azurerm: version = &quot;~&gt; 2.2&quot;

Terraform has been successfully initialized!

You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.

Success! The configuration is valid.


(venv)
</code></pre>

<p>Success!</p>
<p>Now we are ready to start using Terraform in our project directory.</p>
<pre><code class="bash">cd $HOME/Playground/Terraform_Project/Terraform-Playground
</code></pre>

<p>Let's do a quick <code>terraform plan</code> and see what all is going to be done.</p>
<pre><code class="bash">terraform plan
...
Refreshing Terraform state in-memory prior to plan...
The refreshed state will be used to calculate this plan, but will not be
persisted to local or remote state storage.


------------------------------------------------------------------------

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # azurerm_resource_group.example_rg_root will be created
  + resource &quot;azurerm_resource_group&quot; &quot;example_rg_root&quot; {
      + id       = (known after apply)
      + location = &quot;eastus&quot;
      + name     = &quot;example-rg-root&quot;
    }

Plan: 1 to add, 0 to change, 0 to destroy.

------------------------------------------------------------------------

Note: You didn't specify an &quot;-out&quot; parameter to save this plan, so Terraform
can't guarantee that exactly these actions will be performed if
&quot;terraform apply&quot; is subsequently run.
</code></pre>

<p>So far so good. Let's go ahead and do a <code>terraform apply</code> now:</p>
<pre><code class="bash">terraform apply
...
An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # azurerm_resource_group.example_rg_root will be created
  + resource &quot;azurerm_resource_group&quot; &quot;example_rg_root&quot; {
      + id       = (known after apply)
      + location = &quot;eastus&quot;
      + name     = &quot;example-rg-root&quot;
    }

Plan: 1 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

azurerm_resource_group.example_rg_root: Creating...
azurerm_resource_group.example_rg_root: Creation complete after 1s [id=/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/example-rg-root]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

The state of your infrastructure has been saved to the path
below. This state is required to modify and destroy your
infrastructure, so keep it safe. To inspect the complete state
use the `terraform show` command.

State path: terraform.tfstate
</code></pre>

<p>Boom. We've successfully created our very first resource group in Azure using
Terraform Builder. The awesome part was we did not need to dig into the Terraform
configurations at all to get everything configured.</p>
<p>Now let's go ahead and create our virtual network. Open up <code>configs.yml</code> and
uncomment the <code>virtual_networks</code> section so our providers <code>AzureRM</code>
configuration now looks like:</p>
<pre><code class="yaml">providers:
  AzureRM:
    resources:
      resource_groups:
        example-rg-root:
          create: true
          module: root
          virtual_networks:
            example-net:
              address_space:
                - 10.0.0.0/16
              create: true
              subnets:
                - 10.0.1.0/24
                - 10.0.2.0/24
</code></pre>

<p>After uncommenting the <code>virtual_networks</code>, run Terraform Builder again:</p>
<pre><code class="bash">python -m terraform_builder --config $HOME/Playground/Terraform_Project/configs.yml --secrets $HOME/Playground/Terraform_Project/secrets.yml --outputdir $HOME/Playground/Terraform_Project
</code></pre>

<p>And now run <code>terraform plan</code> again and we should see the following:</p>
<pre><code class="bash">terraform plan
...
Refreshing Terraform state in-memory prior to plan...
The refreshed state will be used to calculate this plan, but will not be
persisted to local or remote state storage.

azurerm_resource_group.example_rg_root: Refreshing state... [id=/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/example-rg-root]

------------------------------------------------------------------------

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # azurerm_subnet.example_net_subnet_0 will be created
  + resource &quot;azurerm_subnet&quot; &quot;example_net_subnet_0&quot; {
      + address_prefix                                 = &quot;10.0.1.0/24&quot;
      + enforce_private_link_endpoint_network_policies = false
      + enforce_private_link_service_network_policies  = false
      + id                                             = (known after apply)
      + name                                           = &quot;example-net_subnet_0&quot;
      + resource_group_name                            = &quot;example-rg-root&quot;
      + virtual_network_name                           = &quot;example-net&quot;
    }

  # azurerm_subnet.example_net_subnet_1 will be created
  + resource &quot;azurerm_subnet&quot; &quot;example_net_subnet_1&quot; {
      + address_prefix                                 = &quot;10.0.2.0/24&quot;
      + enforce_private_link_endpoint_network_policies = false
      + enforce_private_link_service_network_policies  = false
      + id                                             = (known after apply)
      + name                                           = &quot;example-net_subnet_1&quot;
      + resource_group_name                            = &quot;example-rg-root&quot;
      + virtual_network_name                           = &quot;example-net&quot;
    }

  # azurerm_virtual_network.example_net will be created
  + resource &quot;azurerm_virtual_network&quot; &quot;example_net&quot; {
      + address_space       = [
          + &quot;10.0.0.0/16&quot;,
        ]
      + id                  = (known after apply)
      + location            = &quot;eastus&quot;
      + name                = &quot;example-net&quot;
      + resource_group_name = &quot;example-rg-root&quot;

      + subnet {
          + address_prefix = (known after apply)
          + id             = (known after apply)
          + name           = (known after apply)
          + security_group = (known after apply)
        }
    }

Plan: 3 to add, 0 to change, 0 to destroy.

------------------------------------------------------------------------

Note: You didn't specify an &quot;-out&quot; parameter to save this plan, so Terraform
can't guarantee that exactly these actions will be performed if
&quot;terraform apply&quot; is subsequently run.
</code></pre>

<p>Looks good. So, let's apply this configuration now.</p>
<pre><code class="bash">terraform apply
...
azurerm_resource_group.example_rg_root: Refreshing state... [id=/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/example-rg-root]

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # azurerm_subnet.example_net_subnet_0 will be created
  + resource &quot;azurerm_subnet&quot; &quot;example_net_subnet_0&quot; {
      + address_prefix                                 = &quot;10.0.1.0/24&quot;
      + enforce_private_link_endpoint_network_policies = false
      + enforce_private_link_service_network_policies  = false
      + id                                             = (known after apply)
      + name                                           = &quot;example-net_subnet_0&quot;
      + resource_group_name                            = &quot;example-rg-root&quot;
      + virtual_network_name                           = &quot;example-net&quot;
    }

  # azurerm_subnet.example_net_subnet_1 will be created
  + resource &quot;azurerm_subnet&quot; &quot;example_net_subnet_1&quot; {
      + address_prefix                                 = &quot;10.0.2.0/24&quot;
      + enforce_private_link_endpoint_network_policies = false
      + enforce_private_link_service_network_policies  = false
      + id                                             = (known after apply)
      + name                                           = &quot;example-net_subnet_1&quot;
      + resource_group_name                            = &quot;example-rg-root&quot;
      + virtual_network_name                           = &quot;example-net&quot;
    }

  # azurerm_virtual_network.example_net will be created
  + resource &quot;azurerm_virtual_network&quot; &quot;example_net&quot; {
      + address_space       = [
          + &quot;10.0.0.0/16&quot;,
        ]
      + id                  = (known after apply)
      + location            = &quot;eastus&quot;
      + name                = &quot;example-net&quot;
      + resource_group_name = &quot;example-rg-root&quot;

      + subnet {
          + address_prefix = (known after apply)
          + id             = (known after apply)
          + name           = (known after apply)
          + security_group = (known after apply)
        }
    }

Plan: 3 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

azurerm_virtual_network.example_net: Creating...
azurerm_virtual_network.example_net: Still creating... [10s elapsed]
azurerm_virtual_network.example_net: Creation complete after 13s [id=/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/example-rg-root/providers/Microsoft.Network/virtualNetworks/example-net]
azurerm_subnet.example_net_subnet_1: Creating...
azurerm_subnet.example_net_subnet_0: Creating...
azurerm_subnet.example_net_subnet_0: Creation complete after 1s [id=/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/example-rg-root/providers/Microsoft.Network/virtualNetworks/example-net/subnets/example-net_subnet_0]
azurerm_subnet.example_net_subnet_1: Creation complete after 2s [id=/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/example-rg-root/providers/Microsoft.Network/virtualNetworks/example-net/subnets/example-net_subnet_1]

Apply complete! Resources: 3 added, 0 changed, 0 destroyed.

The state of your infrastructure has been saved to the path
below. This state is required to modify and destroy your
infrastructure, so keep it safe. To inspect the complete state
use the `terraform show` command.

State path: terraform.tfstate
</code></pre>

<p>BOOOOOM!!</p>
<p>Now let's create a VM. So, uncomment the <code>vms</code> section in <code>configs.yml</code> for the
<code>AzureRM</code> provider. After doing so, our provider configuration should look like:</p>
<pre><code class="yaml">providers:
  AzureRM:
    resources:
      resource_groups:
        example-rg-root:
          create: true
          module: root
          virtual_networks:
            example-net:
              address_space:
                - 10.0.0.0/16
              create: true
              subnets:
                - 10.0.1.0/24
                - 10.0.2.0/24
          vms:
            example-vm-root:
              count: 1
              image: ubuntu-18-04-x64
              memory: 1024
              network: example-net
              subnet: 10.0.2.0/24
              num_cpus: 1
              tags: { &quot;environment&quot;: &quot;${var.environment}&quot; }
</code></pre>

<p>After uncommenting the <code>vms</code>, run Terraform Builder again:</p>
<pre><code class="bash">python -m terraform_builder --config $HOME/Playground/Terraform_Project/configs.yml --secrets $HOME/Playground/Terraform_Project/secrets.yml --outputdir $HOME/Playground/Terraform_Project
</code></pre>

<p>And now run <code>terraform plan</code> again and we should see the following:</p>
<pre><code class="bash">terraform plan
...
Refreshing Terraform state in-memory prior to plan...
The refreshed state will be used to calculate this plan, but will not be
persisted to local or remote state storage.

azurerm_resource_group.example_rg_root: Refreshing state... [id=/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/example-rg-root]
azurerm_virtual_network.example_net: Refreshing state... [id=/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/example-rg-root/providers/Microsoft.Network/virtualNetworks/example-net]
azurerm_subnet.example_net_subnet_1: Refreshing state... [id=/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/example-rg-root/providers/Microsoft.Network/virtualNetworks/example-net/subnets/example-net_subnet_1]
azurerm_subnet.example_net_subnet_0: Refreshing state... [id=/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/example-rg-root/providers/Microsoft.Network/virtualNetworks/example-net/subnets/example-net_subnet_0]

------------------------------------------------------------------------

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # azurerm_network_interface.example_vm_root[0] will be created
  + resource &quot;azurerm_network_interface&quot; &quot;example_vm_root&quot; {
      + applied_dns_servers           = (known after apply)
      + dns_servers                   = (known after apply)
      + enable_accelerated_networking = false
      + enable_ip_forwarding          = false
      + id                            = (known after apply)
      + internal_dns_name_label       = (known after apply)
      + location                      = &quot;eastus&quot;
      + mac_address                   = (known after apply)
      + name                          = &quot;example-vm-root-01-nic&quot;
      + private_ip_address            = (known after apply)
      + private_ip_addresses          = (known after apply)
      + resource_group_name           = &quot;example-rg-root&quot;
      + virtual_machine_id            = (known after apply)

      + ip_configuration {
          + name                          = &quot;example-vm-root-01-ip-config&quot;
          + primary                       = (known after apply)
          + private_ip_address            = (known after apply)
          + private_ip_address_allocation = &quot;dynamic&quot;
          + private_ip_address_version    = &quot;IPv4&quot;
          + subnet_id                     = &quot;/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/example-rg-root/providers/Microsoft.Network/virtualNetworks/example-net/subnets/example-net_subnet_1&quot;
        }
    }

  # azurerm_virtual_machine.example_vm_root[0] will be created
  + resource &quot;azurerm_virtual_machine&quot; &quot;example_vm_root&quot; {
      + availability_set_id              = (known after apply)
      + delete_data_disks_on_termination = false
      + delete_os_disk_on_termination    = false
      + id                               = (known after apply)
      + license_type                     = (known after apply)
      + location                         = &quot;eastus&quot;
      + name                             = &quot;example-vm-root-01-&quot;
      + network_interface_ids            = (known after apply)
      + resource_group_name              = &quot;example-rg-root&quot;
      + tags                             = {
          + &quot;environment&quot; = &quot;&quot;
        }
      + vm_size                          = &quot;Standard_DS1_v2&quot;

      + identity {
          + identity_ids = (known after apply)
          + principal_id = (known after apply)
          + type         = (known after apply)
        }

      + storage_data_disk {
          + caching                   = (known after apply)
          + create_option             = (known after apply)
          + disk_size_gb              = (known after apply)
          + lun                       = (known after apply)
          + managed_disk_id           = (known after apply)
          + managed_disk_type         = (known after apply)
          + name                      = (known after apply)
          + vhd_uri                   = (known after apply)
          + write_accelerator_enabled = (known after apply)
        }

      + storage_image_reference {
          + offer     = &quot;UbuntuServer&quot;
          + publisher = &quot;Canonical&quot;
          + sku       = &quot;18.04-LTS&quot;
          + version   = &quot;latest&quot;
        }

      + storage_os_disk {
          + caching                   = &quot;ReadWrite&quot;
          + create_option             = &quot;FromImage&quot;
          + disk_size_gb              = (known after apply)
          + managed_disk_id           = (known after apply)
          + managed_disk_type         = &quot;Standard_LRS&quot;
          + name                      = &quot;example-vm-root-01-&quot;
          + os_type                   = (known after apply)
          + write_accelerator_enabled = false
        }
    }

Plan: 2 to add, 0 to change, 0 to destroy.

------------------------------------------------------------------------

Note: You didn't specify an &quot;-out&quot; parameter to save this plan, so Terraform
can't guarantee that exactly these actions will be performed if
&quot;terraform apply&quot; is subsequently run.
</code></pre>

<p>Now let's run <code>terraform apply</code> once again!</p>
<pre><code class="bash">terraform apply
</code></pre>

<p>And once this has completed you <strong>SHOULD</strong> have your VMs up and running.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../example_builds/example/" class="btn btn-neutral float-right" title="Terraform Project - example">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../about/" class="btn btn-neutral" title="About Terraform Builder"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../about/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../example_builds/example/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
